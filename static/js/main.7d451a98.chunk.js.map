{"version":3,"sources":["notification/activeSubscriptions.js","errorBoundary.js","index.js"],"names":["activeBells","ErrorBoundary","props","state","hasError","networkError","window","addEventListener","setState","this","stretched","icon","fill","children","error","React","Component","checkSubscriptions","activeSubscriptions","XMLHttpRequest","open","location","search","send","onload","JSON","parse","responseText","sessionStorage","setItem","stringify","console","log","bridge","windowFocusTime","windowFocus","windowFocusCounter","App","lazy","CookiePlaceholder","Placeholder","FullApp","fallback","history","pushState","subscribe","e","detail","type","document","body","setAttribute","data","scheme","localStorage","ReactDOM","render","getElementById","then","default","Date","getTime","setTimeout"],"mappings":"iaAAIA,E,2HCsCWC,E,kDAjCX,WAAYC,GAAQ,IAAD,8BACf,cAAMA,IAEDC,MAAQ,CACTC,UAAU,EACVC,cAAc,GALH,E,0CAanB,WAAU,IAAD,OAKL,OAJAC,OAAOC,iBAAiB,WAAW,WAC/B,EAAKC,SAAS,CAACH,cAAc,OAG9BI,KAAKN,MAAMC,SAEN,eAAC,IAAD,CACIM,WAAS,EACTC,KAAM,cAAC,IAAD,CAAmBC,KAAM,eAFnC,iKAIgC,uBAJhC,4UASDH,KAAKP,MAAMW,Y,uCApBtB,SAAgCC,GAC5B,MAAO,CAAEV,UAAU,O,GAXCW,IAAMC,W,SDYnBC,MAdf,WACI,IAAIC,EAAsB,IAAIC,eAC9BD,EAAoBE,KAAK,MAAzB,kEAA2Fd,OAAOe,SAASC,SAAU,GACrHJ,EAAoBK,OACpBL,EAAoBM,OAAS,WACzB,IACIxB,EAAcyB,KAAKC,MAAMR,EAAoBS,cAC7CC,eAAeC,QAAQ,sBAAuBJ,KAAKK,UAAU9B,IAC/D,MAAOc,GACLiB,QAAQC,IAAIlB,MEExBmB,IAAOV,KAAK,gBAEZ,IAEIW,EAFAC,GAAc,EACdC,EAAqB,EAGnBC,EAAMC,gBAAK,kBAAM,uDAEjBC,EAAsB,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,eAAC,IAAD,CAAaC,aAAW,EACpB9B,WAAS,EACTC,KAAM,cAAC,IAAD,CAAoBC,KAAM,eAFpC,sOAImD,uBAJnD,oIAoB5C,SAAS6B,IACL,OACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,EAAD,UACI,cAAC,WAAD,CAAUC,SAAU,cAAC,IAAD,IAApB,SACI,cAACL,EAAD,gBAhBhC/B,OAAOqC,QAAQC,UAAU,KAAM,MAE/BX,IAAOY,WAAU,SAACC,GACQ,yBAAlBA,EAAEC,OAAOC,MACTC,SAASC,KAAKC,aAAa,SAAUL,EAAEC,OAAOK,KAAKC,WAsB3D,IACIC,aAAazB,QAAQ,OAAQ,QAC7BZ,IACAsC,IAASC,OAAO,cAACf,EAAD,IAAYQ,SAASQ,eAAe,SACtD,SACEF,IAASC,OAAOjB,EAAmBU,SAASQ,eAAe,SAG/D,oDAAkBC,MAAK,YAAwB,EAArBC,WAE1BrD,OAAOC,iBAAiB,QAAQ,WAC5B2B,GAAkB,IAAI0B,MAAOC,aAGjCvD,OAAOC,iBAAiB,SAAS,YACzB4B,GAAeC,EAAqB,IACpCnB,IACAkB,GAAc,EACdC,GAAsB,GACd,IAAIwB,MAAOC,UACX3B,EAAkB,OACtBE,EAAqB,EACrBF,GAAkB,IAAI0B,MAAOC,WAEP,GAAtBzB,GACA0B,YAAW,WACP1B,EAAqB,IACtB,SAKf9B,OAAOC,iBAAiB,QAAQ,WACzB4B,IACCA,GAAc,Q","file":"static/js/main.7d451a98.chunk.js","sourcesContent":["var activeBells\r\n\r\nfunction checkSubscriptions() {\r\n    var activeSubscriptions = new XMLHttpRequest()\r\n    activeSubscriptions.open('GET', `https://wotbtournamentvkapp.ru/vkapp/activeSubscriptions${window.location.search}`, true)\r\n    activeSubscriptions.send()\r\n    activeSubscriptions.onload = () => {\r\n        try {\r\n            activeBells = JSON.parse(activeSubscriptions.responseText)  \r\n            sessionStorage.setItem('activeSubscriptions', JSON.stringify(activeBells))\r\n        } catch (error) {\r\n            console.log(error)\r\n        }\r\n    }\r\n}\r\n\r\nexport default checkSubscriptions","import { Icon56WifiOutline } from '@vkontakte/icons';\r\nimport { Placeholder } from '@vkontakte/vkui';\r\nimport React from 'react';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        this.state = {\r\n            hasError: false,\r\n            networkError: false\r\n        }\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        return { hasError: true };\r\n    }\r\n\r\n    render() {\r\n        window.addEventListener('offline', () => {\r\n            this.setState({networkError: true})\r\n        })\r\n\r\n        if(this.state.hasError) {\r\n            return (\r\n                <Placeholder\r\n                    stretched\r\n                    icon={<Icon56WifiOutline fill={'var(--red)'}/>}\r\n                >\r\n                    Нет подключения к интернету <br/> Включите интернет и перезагрузите приложение с очисткой кэша\r\n                </Placeholder>\r\n            )\r\n        }\r\n\r\n        return this.props.children\r\n    }\r\n}\r\n\r\nexport default ErrorBoundary","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport React, { lazy, Suspense } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport './style.css';\r\nimport { AdaptivityProvider, AppRoot, Panel, Placeholder, ScreenSpinner, View } from \"@vkontakte/vkui\";\r\nimport ErrorBoundary from './errorBoundary'\r\nimport { Icon56ErrorOutline } from '@vkontakte/icons';\r\nimport checkSubscriptions from './notification/activeSubscriptions'\r\n\r\n// Init VK  Mini App\r\nbridge.send(\"VKWebAppInit\");\r\n\r\nvar windowFocus = false\r\nvar windowFocusCounter = 0\r\nvar windowFocusTime\r\n\r\nconst App = lazy(() => import('./App'))\r\n\r\nconst CookiePlaceholder =   <AdaptivityProvider>\r\n                                <AppRoot>\r\n                                    <View>\r\n                                        <Panel>\r\n                                            <Placeholder Placeholder\r\n                                                stretched\r\n                                                icon={<Icon56ErrorOutline fill={'var(--red)'}/>}\r\n                                            >\r\n                                                Сервис не может работать с выключенными Cookie <br/> или в режиме инкогнито\r\n                                            </Placeholder>\r\n                                        </Panel>\r\n                                    </View>\r\n                                </AppRoot>\r\n                            </AdaptivityProvider>\r\n\r\n\r\nwindow.history.pushState(null, null)\r\n\r\nbridge.subscribe((e) => {\r\n    if (e.detail.type === \"VKWebAppUpdateConfig\") {\r\n        document.body.setAttribute(\"scheme\", e.detail.data.scheme);\r\n    }\r\n});\r\n\r\nfunction FullApp() {\r\n    return (\r\n        <AdaptivityProvider>\r\n            <AppRoot>\r\n                <View>\r\n                    <Panel>\r\n                        <ErrorBoundary>\r\n                            <Suspense fallback={<ScreenSpinner/>}>\r\n                                <App/>\r\n                            </Suspense>\r\n                        </ErrorBoundary>\r\n                    </Panel>\r\n                </View>\r\n            </AppRoot>\r\n        </AdaptivityProvider>\r\n    )\r\n}\r\n\r\ntry {\r\n    localStorage.setItem('test', 'test')\r\n    checkSubscriptions()\r\n    ReactDOM.render(<FullApp/>, document.getElementById(\"root\"));\r\n} catch {\r\n    ReactDOM.render(CookiePlaceholder, document.getElementById(\"root\"));\r\n}\r\n\r\nimport(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\r\n\r\nwindow.addEventListener('load', () => {\r\n    windowFocusTime = new Date().getTime()\r\n})\r\n\r\nwindow.addEventListener(\"focus\", () => {\r\n    if(!windowFocus && windowFocusCounter < 6) {\r\n        checkSubscriptions()\r\n        windowFocus = true\r\n        windowFocusCounter += 1\r\n        var d = new Date().getTime()\r\n        if (d - windowFocusTime > 2500) {\r\n            windowFocusCounter = 0\r\n            windowFocusTime = new Date().getTime()\r\n        }\r\n        if (windowFocusCounter == 6) {\r\n            setTimeout(() => {\r\n                windowFocusCounter = 0\r\n            }, 30000)\r\n        } \r\n    }\r\n})\r\n\r\nwindow.addEventListener(\"blur\", () => {\r\n    if(windowFocus) {\r\n        windowFocus = false\r\n    }\r\n})\r\n\r\n"],"sourceRoot":""}